# Check copyright
name: Check Copyright

on:
  push:
    branches:
      - release/**
    paths:
      - src/**
  workflow_dispatch:

jobs:
  copyright-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Get branch name
        id: vars
        run: echo ::set-output name=short_ref::${GITHUB_REF#refs/*/}

      - name: Check Copyright
        uses: VinnyBabuManjaly/copyright-action@v1.0.0
        with:
          CopyrightString: '/*\nCopyright Â© 2021-2022 Compose Generator Contributors\nAll rights reserved.\n*/\n\n'
          Path: 'src'
          IgnorePath: 'src/vendor'
          FileType: '.go'
          
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          base: ${{ steps.vars.outputs.short_ref }}
          title: Update copyright notice
          body: Automated update of copyright notice, generated by the [check copyright](https://github.com/compose-generator/compose-generator/actions/workflows/copyright.yml) workflow.
          labels: documentation
          assignees: marcauberer
        env:
          ACTIONS_ALLOW_UNSECURE_COMMANDS: true
